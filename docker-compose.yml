services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: flowers
    ports: ['5432:5432']
    volumes: [pgdata:/var/lib/postgresql/data]
  redis:
    image: redis:7
    ports: ['6379:6379']
  backend:
    image: node:20
    working_dir: /app
    volumes:
      - ./:/app
    command: sh -c "corepack enable && pnpm install && pnpm --filter @flower/backend dev"
    environment:
      DATABASE_URL: postgres://postgres:postgres@postgres:5432/flowers
      REDIS_URL: redis://redis:6379
      JWT_SECRET: dev_secret
      PORT: 9000
    ports: ['9000:9000']
    depends_on: [postgres, redis]
volumes:
  pgdata:
